{% extends "layout.html" %}
{% block styles %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/programa_rotores.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/programa_lm.css') }}">
{% endblock %}
{% block title %}Resultados de Búsqueda - Programa Rotores{% endblock %}
{% block page_header %}Resultados de Búsqueda Global (Rotores){% endblock %}

{% block content %}
<div class="content-section programa-rotores-container">
    <a href="{{ url_for('rotores.programa_rotores') }}" class="btn btn-secondary mb-3"><i class="fas fa-arrow-left mr-2"></i>Volver a Pendientes</a>

    <div class="card card-body mb-4">
        <h4>Buscar en Todas las Órdenes</h4>
        <form method="GET" action="{{ url_for('rotores.search_rotores') }}">
            <div class="form-row align-items-end">
                <div class="form-group col-md-5"><label for="item_filter">Buscar por Item:</label><input type="text" class="form-control" id="item_filter" name="item_filter" value="{{ filtros.get('item_filter', '') }}" placeholder="Escribe parte del Item..."></div>
                <div class="form-group col-md-5"><label for="item_number_filter">Buscar por Item Number:</label><input type="text" class="form-control" id="item_number_filter" name="item_number_filter" value="{{ filtros.get('item_number_filter', '') }}" placeholder="Escribe parte del Item Number..."></div>
                <div class="form-group col-md-2 d-flex" style="gap: 0.5rem;"><button type="submit" class="btn btn-primary btn-sm w-100"><i class="fas fa-search"></i> Buscar</button><a href="{{ url_for('rotores.search_rotores') }}" class="btn btn-secondary btn-sm w-100">Limpiar</a></div>
            </div>
        </form>
    </div>

    <h5 class="mb-3">Se encontraron {{ ordenes|length }} resultados.</h5>

    <div class="table-responsive">
        <table class="table table-bordered table-hover lm-table">
            <thead class="thead-light">
                <tr>
                    <th style="width: 120px;">Estado</th>
                    <th>Item</th>
                    <th>Item Number</th>
                    <th>Cantidad</th>
                    {% for columna in columnas %}<th>{{ columna.nombre }}</th>{% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for orden in ordenes %}
                <tr class="{% if orden.status == 'Aprobada' %}table-success{% endif %}">
                    <td class="text-center align-middle">
                        {% if orden.status == 'Pendiente' %}<span class="badge badge-warning">Pendiente</span>
                        {% else %}<span class="badge badge-success">Aprobada</span>
                        {% endif %}
                    </td>
                    <td class="align-middle font-weight-bold">{{ orden.item }}</td>
                    <td class="align-middle">{{ orden.item_number or '' }}</td>
                    <td class="align-middle text-center">{{ orden.cantidad }}</td>
                    {% for columna in columnas %}
                        {% set celda_obj = datos.get((orden.id, columna.id)) %}
                        <td class="align-middle">{{- celda_obj.valor if celda_obj else '' -}}</td>
                    {% endfor %}
                </tr>
                {% else %}
                <tr><td colspan="{{ 4 + columnas|length }}" class="text-center text-muted py-4">No se encontraron resultados. Por favor, intenta con otros términos.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}